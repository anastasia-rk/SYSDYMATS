% !TeX TXS-program:compile = txs:///pdflatex/[--shell-escape]

\documentclass[a4paper,11pt,twoside]{article}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% A generic report compiler for publishing rables and plots for a partcular choise of lags in the NARX system
% A path to media corresponding to the setting is defined below, as well as chosen parameter settings
\makeatletter
\def\input@path{{../Results_set_C_ny_4_nu_4/}}
\def\dataset{C}
\def\ny{4}
\def\nu{4}
\def\order{2}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages
\usepackage[final]{pdfpages}
\usepackage{verbatim}
\usepackage{inputenc}
\usepackage{graphicx} 
\usepackage{amsmath,amssymb,mathrsfs,amsfonts}
\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{calrsfs}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{eucal}    
\usepackage{amssymb}  
\usepackage{pifont}
\usepackage{color} 
\usepackage{cancel}
\usepackage[toc,page]{appendix}
\usepackage{pgfplots}
\pgfplotsset{every axis/.append style={line width=0.5pt},label style={font=\small},tick label style={font=\small},x tick label style={/pgf/number format/.cd,fixed,precision=3, set thousands separator={}},y tick label style={/pgf/number format/.cd,fixed,precision=3, set thousands separator={}},z tick label style={/pgf/number format/.cd,fixed,precision=3, set thousands separator={}},x label style={font={\small},at={(axis description cs:0.5,0.0)},anchor=north},y label style={font={\small},at={(axis description cs:0.05,0.5)},anchor=south},z label style={font={\small},at={(axis description cs:-0.25,0.5)},anchor=north}}
\usetikzlibrary{shapes,shadows,arrows,backgrounds,patterns,positioning,automata,calc,decorations.markings,decorations.pathreplacing,bayesnet,arrows.meta} 
\usepackage{varwidth}
\usepackage{lscape}
\usepackage{array} 
\usepackage[colorlinks=false,pdfborder={0 0 0}]{hyperref}
\usepackage{tabularx}
\usepackage{textcomp}
\usepackage{multicol} 
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[font=small,labelfont=bf]{caption}                                                           
\usepackage{textcase}
\usepackage{bbm} 
\usepackage{fancyhdr}
\usepackage{enumitem}
\usepackage{soul}
\usepackage{wrapfig}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Geometry
\setlength{\parindent}{2em}
\setlength{\parskip}{0.5em}
\renewcommand{\baselinestretch}{1.2}
\usepackage[left=2cm, right=2cm, top=2.5cm, bottom=3cm, headheight=13.6pt]{geometry}
\allowdisplaybreaks 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bibliography
\usepackage[backend=bibtex,style=ieee,sorting=none]{biblatex} 
\bibliography{bibliography}
\renewcommand*{\bibfont}{\scriptsize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom commands and operators
\makeatletter
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\newcommand{\ie}{\textit{i.e.} }
\newcommand{\eg}{\textit{e.g.} }
\newcommand\id{\ensuremath{\mathbbm{1}}} 
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\eye}{\mathbb{I}}
\DeclareMathOperator{\zeros}{\mathbb{O}}
\DeclareMathOperator{\tr}{\textrm{tr}}
\DeclareMathOperator{\vvec}{\textrm{vec}}
\DeclareMathOperator{\ik}{\mathrm{k}}
\DeclareMathOperator{\ip}{\mathrm{p}}
\DeclareMathOperator{\inn}{\mathrm{n}}
\DeclareMathOperator{\im}{\mathrm{m}}
\DeclareMathOperator{\td}{\mathrm{t}}
\DeclareMathOperator{\kd}{\mathrm{k}}
\DeclareMathOperator{\T}{\mathrm{T}}
\DeclareMathOperator{\K}{\mathrm{K}}
\DeclareMathOperator{\rk}{\mathrm{rk}}
\DeclareMathOperator{\vc}{\mathrm{vec}}
\DeclareSymbolFontAlphabet{\mathcal} {symbols}
\DeclareSymbolFont{symbols}{OMS}{cm}{m}{n}
\DeclareMathAlphabet{\mathbfit}{OML}{cmm}{b}{it}
\makeatother
% Number equations
%\numberwithin{equation}{section}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Theorems
\newtheoremstyle{mytheoremstyle} % name
{.5em}                    % Space above
{.8em}                    % Space below
{\itshape}                % Body font
{1em}                           % Indent amount
{\bfseries}                   % Theorem head font
{:}                          % Punctuation after theorem head
{.5em}                       % Space after theorem head
{}  % Theorem head spec (can be left empty, meaning ‘normal’)

\theoremstyle{mytheoremstyle}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{remark}{Remark}[section]
\newtheorem{assumption}{Assumption}[section]
\newtheorem{lemma}{Lemma}[section]
\newtheorem{condition}{Condition}[section]
\newtheorem{definition}{Definition}[section]
\newtheorem{property}{Property}[section]
\newtheorem{corollary}{Corollary}[section]
\renewcommand\qedsymbol{$\blacksquare$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Nomenclature
\usepackage[intoc]{nomencl}
\makenomenclature

\usepackage[ruled]{algorithm}
\usepackage{float}

\usepackage{algorithmic}
\algsetup{linenosize=\scriptsize}
\usepackage{etoolbox}
\AtBeginEnvironment{algorithmic}{\scriptsize}
\renewcommand{\thealgorithm}{\thechapter.\arabic{algorithm}} 
%\usepackage{chngcntr}
%\counterwithin{algorithm}{section}
% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[explicit]{titlesec}
\usepackage{titletoc}
\interfootnotelinepenalty=10000

\title{Structure and parameter identification of the dynamical model of auxetic foam}

\begin{document}
	\maketitle
\par Experimental data is described in the earlier reports. This report summarises the settings used for model identification and presents estimation and modelling results.
\section{Structure identification}
\par The following model structure is assumed. The output of the NARX model $\mathbfit{y}(t)$ is the measured load. The input vector is composed as
\begin{equation}
	\mathbfit{x}(t) = \{x_i(t)\}^{d}_{i=1} = \left[\{y(t - k)\}^{n_y}_{k=1} \quad \{u(t - k + n_y + 1)\}^{n_y + n_u}_{k= n_y + 1} \right]^{\top},
\end{equation}
where $n_u$ is the length of the input lag and $n_y$ is the length of the output lag in discrete time, and where $d = n_u + n_y$. In this case, the identification is performed under the following assumptions:
\begin{itemize}[noitemsep,topsep=0.3pt,parsep=0.3pt,partopsep=0.2pt,labelindent=1cm] 
	\item the output lag $n_y =\ny$.
	\item the input signal has a lag of length $n_u = \nu$.
\end{itemize}
The resultant input vector of the NARX model then takes the following form:
\begin{equation}
\mathbfit{x}(t) = \left[\begin{array}{cccccc}
u(t-n_u) & \dots & y(t-1) & u(t-n_u+1) & \dots & u(t)
\end{array}\right]^{\top}.
\end{equation}
The unknown model is approximated with a sum of polynomial basis functions up to second degree ($\lambda = \order$), rendering the following structure
\begin{equation}\label{eq:narx}
	\mathbfit{y}(t) = \theta^0 + \sum_{i=1}^{d} \theta_i x_i(t) + \sum_{i=1}^{d} \sum_{j=1}^{d} \theta_{i,j} x_i(t) x_j(t) + e(t).
\end{equation}
The number and order of significant terms are identified within the EFOR-CMSS algorithm based on the data from 8 out of 10 datasets. Figure \ref{fig:aamdl} illustrates the relationship between the number of model terms and the selected criterion of significance, AAMDL.
\begin{figure}[!h]
	\definecolor{mycolor1}{rgb}{0.00000,0.44700,0.74100}%
	\definecolor{mycolor2}{rgb}{0.85000,0.32500,0.09800}%
	\centering
	\subfloat[Sample size 2000.]{\input{AAMDL_T_2000.tikz}}
	\subfloat[Sample size 4000.]{\input{AAMDL_T_4000.tikz}}
	\resizebox{!}{0cm}{
		\begin{minipage}{\textwidth}
			\begin{tikzpicture}	
			\begin{axis}[width=2cm,height=2cm]
			\addplot [color=mycolor2,line width=5.0pt,only marks,mark=asterisk,mark options={solid},forget plot]
			table[row sep=crcr]{%
				8	-3.00104696019893\\
			};\label{tikz:nterms}
			\end{axis}
			\end{tikzpicture}%
	\end{minipage}}
	\caption{Evolution of AAMDL with the respect to the number of terms for samples of different size. The optimal number of terms (\ref{tikz:nterms}) increases with the growing sample size.}\label{fig:aamdl}
\end{figure}	
\section{Parameter estimation}
\par The results of internal parameter estimation via the EFOR-CMSS method for sample sizes of 2000 and 4000 points are presented in Tables \ref{tab:thetas2000} and \ref{tab:thetas4000}, respectively.
\begin{table}[!h]
	\centering
	\caption{Estimated parameters for the sample length 2000.}\label{tab:thetas2000}
	\small
	\input{Thetas_T_2000.tex}
\end{table}
\begin{table}[!h]
	\centering
	\caption{Estimated parameters for the sample length 4000.}\label{tab:thetas4000}
	\small
	\input{Thetas_T_4000.tex}
\end{table}
\par In order to link the external and internal parameters, an arbitrary polynomial function of two arguments is formed
\begin{equation}
\theta_i(L_{cut},D_{rlx}) = \beta_0 + \beta_1 L_{cut} + \beta_2 D_{rlx} + \beta_3 L_{cut}^{2} + \beta_4 D_{rlx}^{2} + \beta_5 L_{cut} D_{rlx}, \qquad i=1,\dots,N_s,
\end{equation}
where $L_{cut}$ and $D_{rlx}$ are the external parameters of manufacturing process, and where $N_s$ is the estimated number of the significant terms. The coefficients $B = \left[ \beta_0 \dots \beta_5 \right]$ are unknown and must be estimated from the internal parameter values available. The linear relationship between the batch of internal parameter values corresponding to each significant term $\Theta_i$ and the surface coefficients can be established in the following form
\begin{equation}\label{eq:linrel}
\left[\begin{array}{c}
\theta_{i}^{1} \\
\vdots \\
\theta_{i}^{k} \\
\vdots \\
\theta_{i}^{K}
\end{array}\right] =
\left[\begin{array}{cccccc}
1 & L& D& L\times L& D\times D& L\times D
\end{array}\right] B,
\end{equation}
where $k = 1, \dots, K$ is the index of the dataset, $i =1, \dots, N_s$ is the element index of the internal parameter vector, and where $\times$ denotes the by-element product such that
\begin{equation*}
L\times L = \Big[ L_{cut}^{(j)} L_{cut}^{(j)}\Big]^{N}_{j=1}.
\end{equation*}
Given the equation \eqref{eq:linrel}, the vector of unknown coefficients $B$ can be identified via the classical least squares (LS) method. The estimated coefficients are presented in Table \ref{tab:betas_all}, and the surface fitting results for each internal parameter are illustrated in Figure \ref{fig:surfaces_all} 
\begin{table}[!h]
	\centering
	\caption{Estimated polynomial coefficients for the sample length 2000.}\label{tab:betas_all}
	\small
	\input{Betas_T_2000.tex}
\end{table}
The figure also shows values of the internal parameters computed for the external settings of experiments \dataset3 and \dataset8. The obtained internal parameters are substituted in the modified version of model \eqref{eq:narx} that only includes the identified significant  polynomial terms to validate the identified model structure. The simulation results are compared with true system outputs for \dataset3 and \dataset8 in Figure \ref{fig:c3all} and Figure \ref{fig:c8all}, respectively. Computed RMSEs for both lengths of the sample are presented in Table \ref{tab:RMSEs}.
\begin{table}[!h]
	\centering
	\caption{RMSE of the system output generated by the identified model.}\label{tab:RMSEs}
		\begin{tabular}{cc}
			Sample size 2000 & Sample size 4000 \\
			\hline	
			\begin{minipage}{2in} \verbatiminput{RMSEs_T_2000.txt}\end{minipage}& 
			\begin{minipage}{2in} \vspace{0.5cm}\verbatiminput{RMSEs_T_4000.txt}\end{minipage}\\
			\hline
		\end{tabular}
\end{table}

\begin{figure}[!t]
	\centering
	\resizebox{!}{0cm}{
		\begin{minipage}{\textwidth}
		\input{surf_labels.tikz}
	\end{minipage}}
	\input{Theta_surfaces_T_2000.tikz}
	\caption{The quantitative relationship between external parameters ($L_{cut}, D_{rlx}$) and internal parameters $\theta$ is obtained by fitting a polynomial surface to the internal parameter values estimated for the sets \dataset1-\dataset5 (\ref{tikz:thetas1}) and sets \dataset6-\dataset10 (\ref{tikz:thetas2}). The fitted surfaces (\ref{tikz:theta_surf}) are then used to compute the internal model parameters corresponding to the settings of choice (\ref{tikz:thetaidentified}).}\label{fig:surfaces_all}
\end{figure}
\begin{figure}[!t]
	\centering
	\subfloat[\dataset3]{\input{C3_gen_y_T_2000.tikz}\label{fig:c3all}}\\
	\subfloat[\dataset8]{\input{C8_gen_y_T_2000.tikz}\label{fig:c8all}}
	\caption{Samples of the output obtained experimentally and the output generated by the identified model.}\label{fig:Callout}
\end{figure}
\end{document}