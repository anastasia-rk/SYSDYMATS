\documentclass[a4paper,11pt,twoside]{article}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages
\usepackage[final]{pdfpages}
\usepackage{verbatim}
\usepackage{inputenc}
\usepackage{graphicx} 
\usepackage{amsmath,amssymb,mathrsfs,amsfonts}
\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{calrsfs}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{eucal}    
\usepackage{amssymb}  
\usepackage{pifont}
\usepackage{color} 
\usepackage{cancel}
\usepackage[toc,page]{appendix}
\usepackage{pgfplots}
\pgfplotsset{every axis/.append style={line width=0.5pt},label style={font=\scriptsize},tick label style={font=\scriptsize},x tick label style={/pgf/number format/.cd,fixed,precision=3, set thousands separator={}},z tick label style={/pgf/number format/.cd,fixed,precision=3, set thousands separator={}}}
\usetikzlibrary{shapes,shadows,arrows,backgrounds,patterns,positioning,automata,calc,decorations.markings,decorations.pathreplacing,bayesnet,arrows.meta}
%\usepackage{tikzexternal}
%\usepackage{tikz}
%\usepgfplotslibrary{external} 
%\tikzexternalize
\usepackage{varwidth}
\usepackage{lscape}
\usepackage{array} 
\usepackage[colorlinks=false,pdfborder={0 0 0}]{hyperref}
\usepackage{tabularx}
\usepackage{textcomp}
\usepackage{multicol} 
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[font=small,labelfont=bf]{caption}                                                           
\usepackage{textcase}
\usepackage{bbm} 
\usepackage{fancyhdr}
\usepackage{enumitem}
\usepackage{soul}
%\usepackage[british]{babel}
\usepackage{wrapfig}
%\usepackage{glossaries}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\parindent}{2em}
\setlength{\parskip}{0.5em}
\renewcommand{\baselinestretch}{1.2}
\usepackage[left=2cm, right=2cm, top=2.5cm, bottom=3cm, headheight=13.6pt]{geometry}
\allowdisplaybreaks 
% Bibliography
\usepackage[backend=bibtex,style=ieee,sorting=none]{biblatex} 
\bibliography{bibliography}
\renewcommand*{\bibfont}{\scriptsize}
\makeatletter
\def\input@path{{../Results_set_C_ny_0_nu_4/}}
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\newcommand{\ie}{\textit{i.e.} }
\newcommand{\eg}{\textit{e.g.} }
\newcommand\id{\ensuremath{\mathbbm{1}}} 
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\eye}{\mathbb{I}}
\DeclareMathOperator{\zeros}{\mathbb{O}}
\DeclareMathOperator{\tr}{\textrm{tr}}
\DeclareMathOperator{\vvec}{\textrm{vec}}
\DeclareMathOperator{\ik}{\mathrm{k}}
\DeclareMathOperator{\ip}{\mathrm{p}}
\DeclareMathOperator{\inn}{\mathrm{n}}
\DeclareMathOperator{\im}{\mathrm{m}}
\DeclareMathOperator{\td}{\mathrm{t}}
\DeclareMathOperator{\kd}{\mathrm{k}}
\DeclareMathOperator{\T}{\mathrm{T}}
\DeclareMathOperator{\K}{\mathrm{K}}
\DeclareMathOperator{\rk}{\mathrm{rk}}
\DeclareMathOperator{\vc}{\mathrm{vec}}
\DeclareSymbolFontAlphabet{\mathcal} {symbols}
\DeclareSymbolFont{symbols}{OMS}{cm}{m}{n}
\DeclareMathAlphabet{\mathbfit}{OML}{cmm}{b}{it}
\makeatother
% Number equations
%\numberwithin{equation}{section}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Theorems
\newtheoremstyle{mytheoremstyle} % name
{.5em}                    % Space above
{.8em}                    % Space below
{\itshape}                % Body font
{1em}                           % Indent amount
{\bfseries}                   % Theorem head font
{:}                          % Punctuation after theorem head
{.5em}                       % Space after theorem head
{}  % Theorem head spec (can be left empty, meaning ‘normal’)

\theoremstyle{mytheoremstyle}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{remark}{Remark}[section]
\newtheorem{assumption}{Assumption}[section]
\newtheorem{lemma}{Lemma}[section]
\newtheorem{condition}{Condition}[section]
\newtheorem{definition}{Definition}[section]
\newtheorem{property}{Property}[section]
\newtheorem{corollary}{Corollary}[section]
\renewcommand\qedsymbol{$\blacksquare$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Nomenclature
\usepackage[intoc]{nomencl}
\makenomenclature

%\usepackage[ruled,chapter]{algorithm}
%\usepackage{float}

%\usepackage{algorithmic}
%\algsetup{linenosize=\scriptsize}
%\usepackage{etoolbox}
%\AtBeginEnvironment{algorithmic}{\scriptsize}
%\renewcommand{\thealgorithm}{\thechapter.\arabic{algorithm}} 
%\usepackage{chngcntr}
%\counterwithin{algorithm}{section}

% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Captions
%\newcommand{\xLanguage}{british}          % <-- Added this command
%
%\usepackage[\xLanguage]{babel}             % <-- Implemented here
%
%\expandafter\addto\csname captions\xLanguage\endcsname{% <-- and here
%	\renewcommand{\tableshortname}{Table}%
%	\renewcommand{\figureshortname}{Figure}%
%}
%
%\captionsetup[table]{format=plain,indention=1.15cm,justification=justified}
%\captionsetup[figure]{format=plain,indention=1.25cm,justification=justified}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[explicit]{titlesec}
\usepackage{titletoc}
%\titleformat{\section}[block]{\normalfont\Large\rm\filright\bfseries}{\thesection}{1em}{#1}
%\titlecontents{chapter}[1.5em]{}{\scshape\contentslabel{2.3em}}{}{\titlerule*[1pc]{}\contentspage}
%\definecolor{gray75}{gray}{0.5}
%\newcommand{\hsp}{\hspace{20pt}}
%\titleformat{\chapter}[hang]{\huge\scshape\filright\bfseries}{\color{gray75}\thechapter}{20pt}{\begin{tabular}[t]{@{\color{gray75}\vrule width 2pt\hsp}p{0.85\textwidth}}\raggedright#1\end{tabular}}
%\titleformat{name=\chapter,numberless}[display]{}{}{0pt}{\normalfont\huge\bfseries #1} % format for numberless chapters
%\titleformat{\subsection}[block]{\normalfont\large\rm\filright\bfseries}{\thesubsection}{1em}{#1}
%\renewcommand{\sectionmark}[1]{\markright{\thesection ~ \ #1}}
%%\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter ~ \ #1}{}} 
%\pagestyle{fancy}
%%\fancyhf{}
%\fancyhead[RO,LE]{\thepage}
%\fancyhead[RE]{\itshape \nouppercase \rightmark}      % chaptertitle left
%\fancyhead[LO]{\itshape \nouppercase \leftmark}       % sectiontitle right
%\renewcommand{\headrulewidth}{0.5pt} 				   % no rule
%\cfoot{}
\interfootnotelinepenalty=10000

\title{Structure and parameter identification of the dynamical model of auxetic foam}


\begin{document}
	\maketitle
%	\section{Experimental setup}
%	
\section{Experimental data}
\par The experiments is conducted on ten samples of authentic elastomeric foams prepared in different manufacturing settings. In this report, the influence of two manufacturing parameters on the dynamical behaviour of the foam is evaluated: the length of the foam sample after cutting, $L_{cut}$ (mm), and the relaxed density of the sample, $D_{rlx}$ (g/cm$^3$). The parameter values for each specimen are presented in Table \ref{tab:externparams}.
\begin{table}[!h]
	\centering
	\caption{Manufacturing parameters of auxetic form used in 10 experiments.}\label{tab:externparams}
	\scriptsize
	\begin{tabular}{rrrrrrrrrrr}
		Parameter  & C1 & C2 & C3 & C4 & C5 & C6 & C7 & C8 & C9 & C10 \\ 
		\hline 
		$L_{cut}$ & 74 & 72 & 69 & 61 & 56 & 67 & 66 & 64 & 62 & 57 \\ 
		$D_{rlx}$ & 0.123 & 0.113 & 0.104 & 0.095 & 0.093 & 0.276 & 0.255 & 0.230 & 0.209 & 0.193 \\ 
		\hline 
	\end{tabular}
\end{table}
The random input signal adopted for all foam sample is illustrated in Figure \ref{fig:input}. 
\begin{figure}[!h]
	\centering
	\input{data_C_input.tikz}
	\caption{The random input signal for the set of authentic foams is the displacement of the hydraulic actuator of the machine in mm.}\label{fig:input}
\end{figure}
Samples of recorded foam responses are presented in  Figure \ref{fig:output}. The ability to predict the response of a foam specimen to a known input based on manufacturing parameters is crucial in for optimal design. The aim of this report is to identify the dynamical model that could describe the relationship between measured input and output time series conditioned on the external parameters. Datasets C1-C2, C4-C7, and C9-C10 are used for model identification while the datasets C3 and C8 are used to validate the identified model.
\begin{figure}[!t]
	\centering
	\input{data_C_outputs.tikz}
	\caption{The measured output for each foam sample is the force of the specimen response in kN.}
\end{figure}\label{fig:output}
\section{Structure identification}
\par The following model structure is assumed. The output of the NARX model $\mathbfit{y}(t)$ is the measured load. The input vector is composed as
\begin{equation}
	\mathbfit{x}(t) = \{x_i(t)\}^{d}_{i=1} = \left[\{y(t - k + 1)\}^{n_y}_{k=1} \quad \{u(t - k + n_y + 1)\}^{n_y + n_u}_{k= n_y + 1} \right]^{\top},
\end{equation}
where $n_u$ is the length of the input lag and $n_y$ is the length of the output lag in discrete time, and where $d = n_u + n_y$. In this case, the identification is performed under the following assumptions:
\begin{itemize}[noitemsep,topsep=0.3pt,parsep=0.3pt,partopsep=0.2pt,labelindent=1cm] 
	\item only the input signal affects the output ($n_y = 0$).
	\item the input signal has a lag of length $n_u = 4$.
\end{itemize}
The resultant input vector of the NARX model then takes the following form:
\begin{equation}
\mathbfit{x}(t) = \left[\begin{array}{cccc}
u(t-3) & u(t-2) & u(t-1) & u(t)
\end{array}\right]^{\top}.
\end{equation}
The unknown model is approximated with a sum of polynomial basis functions up to second degree ($\lambda = 2$), rendering the following structure
\begin{equation}\label{eq:narx}
	\mathbfit{y}(t) = \theta^0 + \sum_{i=1}^{d} \theta_i x_i(t) + \sum_{i=1}^{d} \sum_{j=1}^{d} \theta_{i,j} x_i(t) x_j(t) + e(t).
\end{equation}
The number and order of significant terms are identified within the EFOR-CMSS algorithm based on the data from 8 out of 10 datasets. Figure \ref{fig:aamdl} illustrates the relationship between the number of model terms and the selected criterion of significance, AAMDL.
\begin{figure}[!h]
	\centering
	\definecolor{mycolor1}{rgb}{0.00000,0.44700,0.74100}%
	\definecolor{mycolor2}{rgb}{0.85000,0.32500,0.09800}%
	\subfloat[Sample size 2000.]{\input{AAMDL_C_2000.tikz}}
	\subfloat[Sample size 4000.]{\input{AAMDL_C_4000.tikz}}
	\caption{Evolution of AAMDL with the respect to the number of terms for samples of different size. The optimal number of terms (\ref{tikz:nterms}) increases with the growing sample size.}\label{fig:aamdl}
\end{figure}	
\section{Parameter estimation}
\par The results of internal parameter estimation via the EFOR-CMSS method for sample sizes of 2000 and 4000 points are presented in Tables \ref{tab:thetas2000} and \ref{tab:thetas4000}, respectively. It can be seen that the first 7 significant terms are the same for both samples; moreover, the estimated values are of the same order in both cases. The further analysis deals only with the parameter estimates obtained from the smaller data sample. 
\begin{table}[!h]
	\centering
	\caption{Estimated parameters for the sample length 2000.}\label{tab:thetas2000}
	\small
	\input{Thetas_C_2000.tex}
\end{table}
\begin{table}[!h]
	\centering
	\caption{Estimated parameters for the sample length 4000.}\label{tab:thetas4000}
	\small
	\input{Thetas_C_4000.tex}
\end{table}
\par In order to link the external and internal parameters, an arbitrary polynomial function of two arguments is formed
\begin{equation}
\theta_i(L_{cut},D_{rlx}) = \beta_0 + \beta_1 L_{cut} + \beta_2 D_{rlx} + \beta_3 L_{cut}^{2} + \beta_4 D_{rlx}^{2} + \beta_5 L_{cut} D_{rlx}, \qquad i=1,\dots,N_s,
\end{equation}
$L_{cut}$ and $D_{rlx}$ are the external parameters of manufacturing process, and where $N_s$ is the estimated number of the significant terms. The coefficients $B = \left[ \beta_0 \dots \beta_5 \right]$ are unknown and must be estimated from the internal parameter values available. The linear relationship between the batch of internal parameter values corresponding to each significant term $\Theta_i$ and the surface coefficients can be established in the following form
\begin{equation}\label{eq:linrel}
\left[\begin{array}{c}
\theta_{i}^{1} \\
\vdots \\
\theta_{i}^{k} \\
\vdots \\
\theta_{i}^{K}
\end{array}\right] =
\left[\begin{array}{cccccc}
1 & L& D& L\times L& D\times D& L\times D
\end{array}\right] B,
\end{equation}
where $k = 1, \dots, K$ is the index of the dataset, $i =1, \dots, N_s$ is the element index of the internal parameter vector, and where $\times$ denotes the by-element product such that
\begin{equation*}
L\times L = \Big[ L_{cut}^{(j)} L_{cut}^{(j)}\Big]^{N}_{j=1}.
\end{equation*}
Given the equation \eqref{eq:linrel}, the vector of unknown coefficients $B$ can be identified via the classical least squares (LS) method. The estimated coefficients are presented in Table \ref{tab:betas_all}, and the surface fitting results for each internal parameter are illustrated in Figure \ref{fig:surfaces_all} 
\begin{table}[!h]
	\centering
	\caption{Estimated polynomial coefficients for the sample length 2000.}\label{tab:betas_all}
	\small
	\input{Betas_C_all_2000.tex}
\end{table}
The figure also shows values of the internal parameters computed for the external settings of experiments C3 and C8. The obtained internal parameters are substituted in the modified version of model \eqref{eq:narx} that only includes the identified significant  polynomial terms to validate the identified model structure. The simulation results are compared with true system outputs for C3 and C8 in Figure \ref{fig:c3all} and Figure \ref{fig:c8all}, respectively. 
\begin{figure}[!t]
	\centering
	\input{Theta_surfaces_C_all_data_2000.tikz}
	\caption{The quantitative relationship between external parameters ($L_{cut}, D_{rlx}$) and internal parameters $\theta$ is obtained by fitting a polynomial surface to the internal parameter values estimated for the sets C1-C5 (\ref{tikz:thetas1}) and sets C6-C10 (\ref{tikz:thetas2}). The fitted surfaces (\ref{tikz:theta_surf}) are then used to compute the internal model parameters corresponding to the settings of choice (\ref{tikz:thetaidentified}).}\label{fig:surfaces_all}
\end{figure}
\section{Estimating from the separated experimental data}
\par The above report replicates the results of \cite{Wei2008} for a different pair of manufacturing parameters. The authors consider all datasets in model identification, however they are collected from two different foam types: sets C1-C5 are obtained from , while sets C6-C10 are obtained from . It is therefore reasonable to consider individual dynamical models for different foam types. For the first foam type, F1, sets C1, C2, C4, and C5 are used for identification, and C3 is used for validation of the dynamical model. For the second foam type, F2, set C8 is used for validation while the rest are used in the identification process. Application of the EFOR-CMSS framework is applied to two different foam types produces similar results, as can be seen in Tables \ref{tab:thetasC15}-\ref{tab:thetasC610}.
\begin{figure}[!t]
	\centering
	\subfloat[C3]{\input{Generated_output_C3_size_2000.tikz}\label{fig:c3all}}\\
	\subfloat[C8]{\input{Generated_output_C8_size_2000.tikz}\label{fig:c8all}}
	\caption{Samples of the output obtained experimentally and the output generated by the identified model.}\label{fig:Callout}
\end{figure}
\begin{table}[!h]
	\centering
	\caption{Estimated parameters for the datasets obtained from foam F1.}\label{tab:thetasC15}
	\small
	\input{Thetas_C1_C5_2000.tex}
\end{table}
\begin{table}[!h]
	\centering
	\caption{Estimated parameters for the datasets obtained from foam F2.}\label{tab:thetasC610}
	\small
	\input{Thetas_C6_C10_2000.tex}
\end{table}
However, difficulties may arise during the stage of mapping the external parameters onto the internal parameter space. Since only 4 data points are estimated for each foam type, a bilinear model is used for surface fitting
\begin{equation}
\theta_i(L_{cut},D_{rlx}) = \beta_0 + \beta_1 L_{cut} + \beta_2 D_{rlx} + \beta_3 L_{cut} D_{rlx}, \qquad i=1,\dots,N_s.
\end{equation}
Model coefficients are estimated with LS method and are presented in Tables \ref{tab:betasC15}-\ref{tab:betasC610}.
\begin{remark}
	It may be possible to perform the direct estimation of the polynomial coefficients from the time series instead of estimating internal parameters in an intermediate step. This would ensure identifiability of higher order polynomials. However, a batch problem of estimating internal parameters from all datasets must be formulated first in order to avoid rank deficiency in the LS matrices. This will be investigated in the future.
\end{remark}
 \begin{table}[!h]
	\centering
	\caption{Estimated polynomial coefficients for the model describing the dynamics of  foam F1.}\label{tab:betasC15}
	\small
	\input{Betas_C1C5_size_2000.tex}
\end{table}
\begin{table}[!h]
	\centering
	\caption{Estimated polynomial coefficients for the model describing the dynamics of  foam F1. foam F2.}\label{tab:betasC610}
	\small
	\input{Betas_C6C10_size_2000.tex}
\end{table}

\begin{figure}[!t]
	\centering
	\input{Theta_surfaces_C1C5_size_2000.tikz}
	\caption{The  surfaces (\ref{tikz:theta_surf}) fitted to the internal parameter values estimated for the sets C1-C5 (\ref{tikz:thetas1}) are  used to compute the internal model parameters corresponding to the settings of choice (\ref{tikz:thetaidentified}).}\label{fig:surfaces_C15}
\end{figure}

\begin{figure}[!h]
	\centering
	\definecolor{mycolor1}{rgb}{0.00000,0.44700,0.74100}%
	\definecolor{mycolor2}{rgb}{0.85000,0.32500,0.09800}%
	\input{Theta_surfaces_C6C10_size_2000.tikz}
	\caption{The  surfaces (\ref{tikz:theta_surf}) fitted to the internal parameter values estimated for the sets C1-C5 (\ref{tikz:thetas2}) are  used to compute the internal model parameters corresponding to the settings of choice (\ref{tikz:thetaidentified}).}\label{fig:surfaces_C610}
\end{figure}

\begin{figure}[!h]
	\centering
	\subfloat[C3]{\input{Generated_output_C3_C1C5.tikz}\label{fig:c3c15}}\\
	\subfloat[C8]{\input{Generated_output_C8_C6C10.tikz}\label{fig:c8c610}}
	\caption{Samples of the output obtained experimentally and the output generated by the models identified from datasets corresponding to Foams (a) F1 and (b) F2.}\label{fig:Csubsets}
\end{figure}
\printbibliography
\end{document}